<style type="text/css">
    body, html {
        padding: 0px;
        margin: 0px;
        overflow: none;
    }

    a {
        text-decoration: none;
    }

    .popup_tab {
        text-align: center;
        padding: 10px 0;
        background-color: #484544;
        width: 100%;
        height: 38px;
        margin-top: -1px;
    }

    .popup_tab a.active {
        background: #b62929;
    }

    .popup_tab a {
        color: #fff;
        text-shadow: 0 1px 1px #000;
        color: #fff;
        display: inline-block;
        font-size: 15px;
        padding: 8px 25px;
        background-color: #393736;
        cursor: pointer;
    }

    .popup_tab a:nth-child(1) {
        border-radius: 6px 0 0 6px;
    }

    .popup_tab a:nth-child(2) {
        border-radius: 0px 6px 6px 0;
    }

    .Tab {
        background-color: #393736;
        width: 228px;
        margin-left: 35%;
        border-radius: 6px;
    }

    .popup_form {
        height: 26px;
        line-height: 26px;
        background: #484544;
        color: #fff;
        font-size: 12px;
    }

    .Fleft {
        float: left;
        margin-left: 10px;

    }

    .Fleft input[type="text"] {
        width: 52px;
        height: 26px;
        border-radius: 6px;
        border: none;
        margin: 0 4px;
        outline: none;
        text-indent: 6px;
    }

    input[type="checkbox"] {
        cursor: pointer;
    }

    .Fleft span:nth-child(2) {
        margin-left: 8px;
    }

    #CK_ROOT_stopAfterSkip, #CK_ROOT_stopAfterWin {
        height: 24px;
        width: 24px;
        opacity: 0;

    }

    .checkbox_one {
        position: absolute;
        top: 2px;
        left: 4px;
        width: 20px;
        height: 20px;
        background-image: url(/page/game/official/images/check_true.png);
        background-repeat: no-repeat;
        background-position: center;
        background-color: #fff;
        border: 1px solid #999;
        border-radius: 5px;
    }

    .checkbox_one_tow {
        background-image: none;
    }

    .checkbox_tow {
        position: absolute;
        top: 2px;
        left: 108px;
        width: 20px;
        height: 20px;
        /*background-image: url(/page/game/official/images/check_true.png);*/
        background-repeat: no-repeat;
        background-position: center;
        background-color: #fff;
        border: 1px solid #999;
        border-radius: 5px;
    }

    .checkbox_tow_one {
        background-image: url(/page/game/official/images/check_true.png);
    }

    .tab_hide {
        display: none;
    }

    .popup_formtow {
        background-color: #484544;
        height: 46px;
        width: 100%;
        line-height: 40px;
    }

    .commonStyle {
        float: left;
        color: #fff;
        font-size: 12px;
    }

    .select_list {
        height: 24px;
        width: 68px;
        border: none;
        border-radius: 6px;
        margin-top: 12px;
        outline: none;
        text-indent: 4px;
        color: #000;
    }

    .commonStyleOne {
        margin: 0 8px;
    }

    .fc_yellow {
        color: #ffe400;
    }

    .popupTitle {
        width: 100%;
        height: 28px;
        background-color: #d5dfe2;
        table-layout: fixed;
    }

    .popupTitle tr {
        width: 100%;
    }

    .popupTitle tr td {
        width: 25%;
        text-align: center;
        font-size: 12px;
        color: #000 !important;
        font-weight: 700;
    }

    .scllorWrap {
        height: 182px;
        width: 100%;
        overflow-x: hidden;
    }

    ul {
        margin: 0px;
        padding: 0px;
    }

    li {
        list-style: none;
    }

    .scllorWrap ul {
        height: 182px;
        width: 100%;
    }

    .scllorWrap ul li {
        height: 30px;
        width: 100%;
        border-bottom: 1px solid #ddd;
    }

    .scllorWrap ul li span {
        width: 25%;
        float: left;
        height: 30px;
        text-align: center;
        line-height: 30px;
        color: #333;
        font-size: 12px;
    }

    .scllorWrap ul li span:nth-child(1) {
        position: relative;
        text-indent: 24px;
    }

    .checkboxTrue {
        width: 20px;
        height: 20px;
        border: 1px solid #ddd;
        position: absolute;
        top: 4px;
        left: 50px;
        background-color: #fff;
        border-radius: 4px;
        /*background-image: url(img/check_true.png);*/
        background-repeat: no-repeat;
        background-position: center;
    }

    .checkboxTrueInput {
        width: 20px;
        height: 20px;
        border: 1px solid #ddd;
        position: absolute;
        top: 4px;
        left: 50px;
        z-index: 1;
    }

    .scllorWrap ul li span input[type="text"] {

        width: 69px;
        border-radius: 4px;
        border: 1px solid #ddd;
        outline: none;
        text-indent: 10px;
    }

    .scllorWrap ul li span input[type="checkbox"] {
        opacity: 0;
    }

    .peishu {
        margin: 0 4px;
    }

    .GenerateAppend {
        margin-right: 30px;
        float: right;
        display: inline-block;
        width: 156px;
        height: 34px;
        background: url(/page/game/official/images/GenerateAppend-bg1.png);
        background-repeat: no-repeat;
        background-position: center;
        border-radius: 6px;
        cursor: pointer;
    }

    .GenerateAppend:hover {
        background: url(/page/game/official/images/GenerateAppend-bg2.png);
        background-repeat: no-repeat;
        background-position: center;
    }
</style>
<div class="popup_tab">
    <div class="Tab">
        <a class="active tab_fu">同倍追号</a>
        <a class="tab_fu">翻倍追号</a>
    </div>
</div>

<div class="popup_form clear">
    <div class="Fleft">
        追号计划：
        <span class="tab_hide tab_show">每隔<input type="text" value="1" id="eachPeriod"></span>
        <span class="tab_hide tab_show">倍x<input type="text" value="2" id="betBs"></span>
        <span>起始倍数<input type="text" id="qsBeishu" value="1"></span>
        <span>追号期数<input type="text" id="qsPeriod" value="10"></span>
    </div>
    <div class="Fleft"></div>
    <div class="Fright" style="padding-left:0;float: right;margin-right: 40px;position: relative;">
        <div class="checkbox_one" id="stopAfterWin"></div>
        <label class="" style="float:left;">
            <input type="checkbox" id="CK_ROOT_stopAfterWin" class="checkbox_hide" style="float:left;">
            <span style="float:left;">中奖后停止追号</span>

        </label>
    </div>
</div><!--  -->


<div class="popup_formtow">
    <div class="Fleft" style="width: 100%">
        <span class="commonStyle">追号期数：</span>
        <div class="select-box commonStyle">
            <!-- <div class="commonStyle"><span>5期</span><i></i></div> -->
            <select class="select_list commonStyle" id="select_4_additional">
                <option value="0">请选择</option>
                <option value="5">5期</option>
                <option value="10">10期</option>
                <option value="15">15期</option>
                <option value="20">20期</option>
                <option value="25">25期</option>
                <option value="-1">所有</option>
            </select>
            <span class="commonStyle commonStyleOne">追号总期数:<label class="fc_yellow" id="zhPeriodNums">0</label></span>
            <span class="commonStyle commonStyleTwo">追号总金额:<label class="fc_yellow" id="zhPeriodMoney">0</label>元</span>

        </div>
        <a class="GenerateAppend"></a>
    </div>

</div>

<table class="popupTitle">
    <tr>
        <td>期号</td>
        <td>倍数</td>
        <td>当前投入</td>
        <td>截止时间</td>
    </tr>
</table>

<div class="scllorWrap">
    <input type="hidden" id="orderMoney">
    <input type="hidden" id="zhTotalMoney">
    <ul style="height: 180px;width: 100%;overflow-x: hidden;" id="additionalPeriod">
        <li>
            <span><div class="checkboxTrue"> <input type="checkbox"
                                                    class="checkboxTrueInput"/><a>20170829</a></div></span>
            <span><input type="text" id="zhBeishu"/><a class="peishu">倍</a></span>
            <span><a>¥</a><a>100</a></span>
            <span>2017-04-26 19:09:40</span>
        </li>
    </ul>
</div>
<script type="text/html" id="additional_period_Template">
    {{each list item i}}
    <li>
        <span><div class="checkboxTrue"><input type="checkbox" class="checkboxTrueInput"/><a class="data-turn-num">{{item.turnNum}}</a></div> </span>
        <span><input type="text" class="zhBeishu" id="zhBeishu"  disabled/><a
                class="peishu">倍</a></span>
        <span><a>¥</a><a id="zhMoney">0</a></span>
        <span>{{item.endTime}}</span>
    </li>
    {{/each}}
</script>

<script type="text/javascript" src="/js/lib/jquery/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="/js/lib/template-web.js"></script>
<script type="text/javascript">

    var changeBtn;
    function setPeriodContent(data, betContentList, fun, flag) {
        changeBtn = fun;
        var totalMoney = 0;
        for (var i = 0; i < betContentList.length; i++) {
            totalMoney +=parseFloat((betContentList[i].money * betContentList[i].totalNums).toFixed(4));
            betContentList[i].totalMoney = parseFloat((betContentList[i].money * betContentList[i].totalNums).toFixed(4));
        }
        $("#orderMoney").val(totalMoney);
        var list = {list: data}
        var html = template('additional_period_Template', list);
        $('#additionalPeriod').html(html);
        $('.checkboxTrue').bind('click', function () {
            if ($(this).hasClass('checkbox_one')) {
                deleteLine($(this))
            } else {
                selectLine($(this))
            }
        })

        //监听input事件，倍数
        $(".zhBeishu").bind('input', function () {
            this.value=parseInt(this.value);
            if (isNaN(this.value) || this.value<=0){
                this.value=0;this.focus();
            }
            $(this).parents('li').find('#zhMoney').html(moneyFixed($(this).val() * parseFloat($('#orderMoney').val())));
            countMoney();
        })

        $('#stopAfterWin').removeClass('checkbox_one_tow')

//        if (flag) {
//            $('#stopAfterWin').removeClass('checkbox_one_tow')
//        } else {
//            $('#stopAfterWin').addClass('checkbox_one_tow')
//        }
    }


    function bsChange(e) {
        $(e).parents('li').find('#zhMoney').html(moneyFixed($(this).val() * parseInt($('#orderMoney').val())));
        countMoney();
    }

    $('#select_4_additional').change(function () {
        var num = $(this).val();
        if(num == -1){
            num = $('.checkboxTrue').length;
        }
        selectPeriod(num)
//        if (num == -1 || 0) {
//            num = $('.checkboxTrue').length;
//            $('#qsPeriod').val('')
//        } else {
            $('#qsPeriod').val(num)
//        }

    })


    //选择一行
    function selectLine(e,stopCount) {
        var eachPeriod = parseInt($('#eachPeriod').val());
        var jsbs = parseInt($('#betBs').val());
        $(e).addClass('checkbox_one')
        if ($('.tab_show').hasClass('tab_hide')) {
            eachPeriod = 1;
            jsbs = 1;
        }

        //循环count money
        if(!stopCount){
            var count = 0;
            $.each($("#additionalPeriod").find('.checkbox_one'), function (i, e) {
                var bs = Math.pow(jsbs, count);
                if( $(e).parents('li').find('#zhBeishu').val() == ''){
                    $(e).parents('li').find('#zhBeishu').val($('#qsbeishu').val() == '' ? 1 : $('#qsBeishu').val() * bs)
                }
                if( $(e).parents('li').find('#zhMoney').html() == ''||$(e).parents('li').find('#zhMoney').html() == 0){
                    $(e).parents('li').find('#zhMoney').html(moneyFixed($('#orderMoney').val() * bs * parseInt($('#qsBeishu').val())))
                }
                $(e).parents('li').find('#zhBeishu').attr('disabled', false)
                if ((i + 1) % eachPeriod == 0) {
                    count++;
                }
            })
            countMoney();
        }

    }

    function countMoney() {
        var count = 0.00;
        $.each($('#additionalPeriod').find('.checkbox_one'), function (i, e) {
//           count +=  parseInt($(e).parents('li').find('#zhBeishu').val())*parseInt($(e).parents('li').find('#zhMoney').html())
            count = FloatAdd(count,parseFloat($(e).parents('li').find('#zhMoney').html()));
        })
        var turnNums = $("#additionalPeriod").find('.checkbox_one').length;
        $('#zhPeriodNums').html(turnNums)
        if (turnNums == 0) {
            changeBtn('直接投注')
        } else {
            changeBtn('追号投注')
        }
        $('#zhTotalMoney').val(count);
        $('#zhPeriodMoney').html(count.toFixed(2));
    }

    //删除一行
    function deleteLine(e) {
        $(e).removeClass('checkbox_one')
        $(e).parents('li').find('#zhMoney').html('0')
        $(e).parents('li').find('#zhBeishu').val('')
        $(e).parents('li').find('#zhBeishu').attr('disabled', true)
        countMoney();
        $("#zhPeriodNums").html($('#additionalPeriod').find('.checkbox_one').length);
//        countMoney();
    }


    function selectPeriod(num) {
        $('.checkboxTrue').removeClass('checkbox_one')
        $('.checkboxTrue').parents('li').find('#zhMoney').html('0')
        $('.checkboxTrue').parents('li').find('#zhBeishu').val('')
        $('.checkboxTrue').parents('li').find('#zhBeishu').attr('disabled', true)
        $("#zhPeriodNums").html($('#additionalPeriod').find('.checkbox_one').length);

        $.each($('.checkboxTrue'), function (i, e) {
//            console.log("i:",i);
//            if(i >= parseInt(num)){
//                return false;
//            }
//            if (num == -1 || num == '-1') {
//                num = $('.checkboxTrue').length;
//            }
//            if (num == -1 || num == '-1') {
//                selectLine($(e),1);
//            } else
                if (i < num) {
                selectLine($(e),1)
            } else {
//                deleteLine($(e))
            }

        })
        var eachPeriod = parseInt($('#eachPeriod').val());
        var jsbs = parseInt($('#betBs').val());
        if ($('.tab_show').hasClass('tab_hide')) {
            eachPeriod = 1;
            jsbs = 1;
        }
        var count = 0;
        $.each($("#additionalPeriod").find('.checkbox_one'), function (i, e) {
            var bs = Math.pow(jsbs, count);
            if( $(e).parents('li').find('#zhBeishu').val() == ''){
                $(e).parents('li').find('#zhBeishu').val($('#qsbeishu').val() == '' ? 1 : $('#qsBeishu').val() * bs)
            }
            if( $(e).parents('li').find('#zhMoney').html() == ''||$(e).parents('li').find('#zhMoney').html() == 0){
                $(e).parents('li').find('#zhMoney').html(moneyFixed($('#orderMoney').val() * bs * parseInt($('#qsBeishu').val())))
            }
            $(e).parents('li').find('#zhBeishu').attr('disabled', false)
            if ((i + 1) % eachPeriod == 0) {
                count++;
            }
        })
        countMoney();
    }

    $('.GenerateAppend').bind('click', function () {
        if ($('#qsPeriod').val() != $('#select_4_additional').val()) {
            $.each($('.zhBeishu'),function (_,e) {
                $(e).val('');
                $(e).parents('li').find('#zhmoney').html(0);
            })
            selectPeriod($('#qsPeriod').val());
        }
        var qss = 0;
        $.each($('#additionalPeriod').find('.checkbox_one'), function (_, e) {
            qss += 1;
        })
        if(qss == 0){
            var select_4_additional = $('#select_4_additional').val()
            var qsPeriod = $('#qsPeriod').val()
            if( select_4_additional == 0){
                qss = qsPeriod
            }else{
                qss = select_4_additional
            }
        }
        selectPeriod(qss)
        $("#zhPeriodNums").html(qss)
//        $('#zhTotalPeriodMoney').html(qss * parseInt($("#zhMoney").val()));
//		console.log($('#select_4_additional').val());
    })

    function generateOrder() {
        var list = [];
        $.each($('#additionalPeriod').find('.checkbox_one'), function (i, e) {
            var turnNum = $(e).parents('li').find('.data-turn-num').html();
            var multiple = $(e).parents('li').find('#zhBeishu').val();
//            var money = $(e).parents('li').find('#zhMoney').html();
            list.push({turnNum: turnNum, multiple: multiple})
//                *parseInt($(e).parents('li').find('#zhMoney').html())
        })

        var stopAfterWin = $("#stopAfterWin").hasClass('checkbox_one_tow') ? 0 : 1;

        return {list: list, totalMoney:   $('#zhPeriodMoney').html(), stopAfterWin: stopAfterWin};
    }


    $('#CK_ROOT_stopAfterWin').bind('click', function () {
        if ($("#stopAfterWin").hasClass('checkbox_one_tow')) {
            $("#stopAfterWin").removeClass('checkbox_one_tow')
        } else {
            $("#stopAfterWin").addClass('checkbox_one_tow')
        }
    })
    $('.tab_fu').bind('click', function () {
        $('.tab_fu').removeClass('active');
        $(this).addClass('active');
        if ($(this).index() == 0) {
            $('.tab_show').addClass('tab_hide');
        } else {
            $('.tab_show').removeClass('tab_hide');
        }
    })

    function FloatAdd(arg1,arg2){
        var r1,r2,m;
        try{r1=arg1.toString().split(".")[1].length}catch(e){r1=0}
        try{r2=arg2.toString().split(".")[1].length}catch(e){r2=0}
        m=Math.pow(10,Math.max(r1,r2));
        return (arg1*m+arg2*m)/m;
    }

    function moneyFixed(val) {
        return parseFloat(numberFixed(val, 2));
    }

    function numberFixed(val, len) {
        var strValue = val + ''
        var start = strValue.indexOf('.')
        if (start > 0 && strValue.length > start + len + 1) {
            var endValue = parseInt(strValue.substr(start + len + 1, 1))
            if (endValue >= 5) {
                var temp = Math.pow(10, len + 1)
                strValue = (val + 1 / temp).toFixed(len);
            } else {
                strValue = strValue.substr(0, start + len + 1)
            }
        }
        return strValue
    }
</script>